<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }

        .hover-bg-body-secondary:hover {
            background-color: #dee2e6 !important;
        }

        .hover-bg-body-secondary {
            transition: background-color 0.3s ease;
        }

        .def-text-color {
            color: #343a40;
        }

        .footer {
            color: #000;
            padding-top: 30px !important;
            margin-top: 120px !important;
        }

        .footer a {
            color: inherit;
        }

        table {
            border-collapse: collapse;
            margin: 2% 0%;
            width: 100%;
        }

        #cart-container {
            width: 80%;
            margin: 2% 10%;
            padding: 1%;
        }

        th,
        td {
            padding: 8px;
            text-align: left;
            font-size: large;
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", "Noto Sans", "Liberation Sans", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        }

        th {
            background-color: #f2f2f2;
        }

        .cart-table-row:hover {
            background-color: #dee2e6;
        }

        img {
            max-width: 100px;
            height: auto;
        }

        .item-number {
            font-weight: bold;
            margin-right: 10px;
        }

        #cart-delete-icon {
            color: #000;
            cursor: pointer;
        }

        @media (min-width:1024px) {

            #mid-header {
                margin: 0% 10%;
                width: 80%;
            }

            #top-header {
                margin: 0% 10%;
                width: 80%;
            }

            .main-carousel {
                margin: 0% 10%;
                width: 80%;
            }

            .footer {
                padding-left: 200px;
                padding-right: 200px;
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <nav class="navbar bg-black">
        <form class="container-fluid justify-content-end" id="top-header">
        </form>
    </nav>
    <nav class="navbar navbar-expand-lg bg-body-secondary py-0">
        <div class="container-fluid" id="mid-header">
            <a class="navbar-brand justify-content-center" href="./index.html">
                <img src="./images/logo.webp" alt="Logo" width="40" height="40"
                    class="d-inline-block align-items-center me-3">
                <a class="me-5 text-decoration-none fs-4 def-text-color" href="./index.html"><strong>WOU
                        Tech</strong></a>
            </a>
            <button class="navbar-toggler border-0 bg-transparent" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarScroll" aria-controls="navbarScroll" aria-expanded="true"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarScroll">
                <ul class="navbar-nav me-auto my-3 my-lg-0 navbar-nav-scroll" style="--bs-scroll-height:full;">
                    <li class="nav-item">
                        <button type="button" class="py-3 px-3 border-0 bg-transparent hover-bg-body-secondary">
                            <a class="nav-link" href="#"><strong>About Us</strong></a>
                        </button>
                    </li>
                    <li class="nav-item">
                        <button type="button" class="py-3 px-3 border-0 bg-transparent hover-bg-body-secondary">
                            <a class="nav-link" href="./product.html"><strong>Product</strong></a>
                        </button>
                    </li>
                    <li class="nav-item">
                        <button type="button" class="py-3 px-3 border-0 bg-transparent hover-bg-body-secondary">
                            <a class="nav-link" href="./service.html"><strong>Services</strong></a>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid" id="cart-container">
        <h2>Your Shopping Cart</h2>
        <p class="no-order-message mt-4" id="noCartMessage" style="display: none;">
            You have not added any items yet. Start now by
            <a href="./product.html">adding products to your cart</a>
        </p>
        <table id="cartTable" style="display: none;">
            <thead></thead>
            <tbody id="cartBody"></tbody>
        </table>
        <div class="d-flex justify-content-end mt-3" id="checkoutButtonContainer" style="display: none;">
            <a href="./checkout.html" class="btn btn-success fs-5 px-5 py-2" id="checkoutButton">Checkout</a>
        </div>
    </div>

    <footer class="footer py-4 bg-body-secondary">
        <div class="container">
            <div class="row ms-5">
                <!-- Contact Section (Merged Email & Working Hours) -->
                <div class="col-md-4">
                    <h6 class="fw-bold">Contact</h6>
                    <p>012 - 3456789<br>013 - 4578991<br>019 - 9867866</p>

                    <h6 class="fw-bold mt-5">Email</h6>
                    <p>contact@woutech.help.com</p>
                </div>

                <!-- Address Section -->
                <div class="col-md-4">
                    <h6 class="fw-bold">Address</h6>
                    <p>7, Gat Lebuh China,<br>Taman Dhoby Ghaut,<br>10300 George Town,<br>Pulau Pinang</p>

                    <h6 class="fw-bold mt-5">Working Hours</h6>
                    <p>Mon-Fri: 9:00 am - 6:00 pm<br>Sat-Sun: 9:00 am - 3:00 pm</p>
                </div>

                <!-- Social Media & Payment Methods -->
                <div class="col-md-4">
                    <h6 class="fw-bold">Follow Us</h6>
                    <a href="https://www.facebook.com/"><img src="./images/facebook.webp" alt="Facebook" width="35"
                            class="me-3"></a>
                    <a href="https://www.instagram.com/"><img src="./images/insta.webp" alt="Instagram" width="35"
                            class="me-3"></a>
                    <a href="https://x.com/?lang=en"><img src="./images/x.webp" alt="X" width="35" class="me-3"></a>
                    <a href="https://www.youtube.com/"><img src="./images/youtube.webp" alt="YouTube" width="40"
                            class="me-3"></a>

                    <h6 class="fw-bold mt-4">We Accept</h6>
                    <div class="row">
                        <div class="col-3 text-center">
                            <img src="./images/paypal.webp" alt="PayPal" width="70">
                        </div>
                        <div class="col-3 text-center">
                            <img src="./images/visa.webp" alt="Visa" width="70">
                        </div>
                        <div class="col-3 text-center">
                            <img src="./images/mastercard.webp" alt="MasterCard" width="70">
                        </div>
                        <div class="col-5 text-center mt-2">
                            <img src="./images/tng.webp" alt="Touch 'n Go" width="60">
                        </div>
                        <div class="col-2 text-center mt-2">
                            <img src="./images/grabpay.webp" alt="GrabPay" width="60">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Copyright Section -->
            <div class="mt-5 text-center">
                <p>Â© 2025 WOU Tech Sdn. Bhd. All Rights Reserved |
                    <a href="#">Privacy Policy</a> |
                    <a href="#">Terms & Regulations</a>
                </p>
            </div>
        </div>
    </footer>
    <script>
        $(document).ready(function () {
            // Function to load cart data
            function loadCart() {
                const userId = parseInt(localStorage.getItem('user_id')) || 1;

                $.ajax({
                    url: './php/cart.php',
                    type: 'GET',
                    data: { user_id: userId },
                    dataType: 'json',
                    success: function (response) {
                        if (response.error) {
                            alert(response.error);
                            return;
                        }

                        $('#cartTable thead').empty();
                        $('#cartBody').empty();

                        if (response.length === 0) {
                            $('#noCartMessage').show();
                            $('#cartTable').hide();
                            $('#checkoutButton').hide();
                            return;
                        } else {
                            $('#noCartMessage').hide();
                            $('#cartTable').show();
                            $('#checkoutButton').show();
                        }

                        let subtotal = 0;  // Changed from grandTotal to subtotal
                        $.each(response, function (index, item) {
                            let itemNumber = index + 1;
                            let itemPrice = parseFloat(item.price) || 0;
                            let itemQuantity = parseInt(item.quantity_added) || 0;
                            let itemTotal = itemPrice * itemQuantity;
                            subtotal += itemTotal;  // Changed from grandTotal to subtotal
                            localStorage.setItem('subtotal', subtotal.toFixed(2));  // Changed key from grandTotal to subtotal

                            let row = `<tr class="align-middle cart-table-row">
                                <td><span class="item-number">${itemNumber}.</span></td>
                                <td><img src="${item.product_image}" alt="${item.product_name}" class="img-fluid" style="max-width: 100px;"></td>
                                <td>${item.product_name}</td>
                                <td>RM ${itemPrice.toFixed(2)}</td>
                                <td><input type="number" class="form-control quantity-input" data-product-id="${item.product_id}" min="0" max="${item.quantity_left}" value="${itemQuantity}"></td>
                                <td></td>
                                <td><h3 href="#" class="delete-item" id="cart-delete-icon" data-product-id="${item.product_id}"><i class="fa-solid fa-trash"></i></h3></td>
                                <td class="text-end">RM</td>
                                <td class="text-end">${itemTotal.toFixed(2)}</td>
                            </tr>`;
                            $('#cartBody').append(row);
                        });

                        // Update the grand total row display (keeping the visual label as "Grand Total" if desired)
                        let grandTotalRow = `<tr class="cart-total-row">
                            <td colspan="7" class="text-end"><strong>Grand Total:</strong></td>
                            <td class="text-end">RM</td>
                            <td class="text-end">${subtotal.toFixed(2)}</td>  // Changed from grandTotal to subtotal
                        </tr>`;
                        $('#cartBody').append(grandTotalRow);

                        // Rest of the code remains the same...
                        document.querySelectorAll('.quantity-input').forEach(input => {
                            input.addEventListener('change', function () {
                                const productId = this.getAttribute('data-product-id');
                                const newQuantity = parseInt(this.value) || 0;
                                const maxQuantity = parseInt(this.max);

                                if (newQuantity < 0) {
                                    this.value = 0;
                                    alert('Quantity cannot be negative.');
                                } else if (newQuantity > maxQuantity) {
                                    this.value = maxQuantity;
                                    alert(`Maximum quantity is ${maxQuantity} for this product.`);
                                } else {
                                    updateCartQuantity(userId, productId, newQuantity);
                                }
                            });
                        });

                        document.querySelectorAll('.delete-item').forEach(link => {
                            link.addEventListener('click', function (e) {
                                e.preventDefault();
                                const productId = this.getAttribute('data-product-id');
                                if (confirm('Are you sure you want to delete this item from your cart?')) {
                                    deleteCartItem(userId, productId);
                                }
                            });
                        });
                    },
                    error: function (xhr, status, error) {
                        alert('Error loading cart: ' + error);
                    }
                });
            }

            // Rest of the functions (updateCartQuantity and deleteCartItem) remain unchanged...

            // Load cart on page load
            loadCart();
        });
    </script>

    <!-- Header -->
    <script>
        function updateHeader() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const typeId = parseInt(localStorage.getItem('type_id')) || 0;
            const topHeader = document.getElementById('top-header');

            if (isLoggedIn && typeId !== 3) {
                topHeader.innerHTML = `
                    <div class="navbar-brand"></div>
                    <div class="d-flex align-items-center">
                        <a class="btn btn-link text-white text-decoration-none me-3" type="button" id="cart-btn" href="./cart.html">
                            <i class="fa-solid fa-cart-shopping"></i> Cart
                        </a>
                        <div class="dropdown">
                            <button class="btn btn-link text-white text-decoration-none dropdown-toggle" type="button" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fa-solid fa-user"></i> Profile
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                                <li><a class="dropdown-item" href="./profile.html">Profile Info</a></li>
                                <li><a class="dropdown-item" href="./address.html">Address</a></li>
                                <li><a class="dropdown-item" href="./order_tracking.html">Order Tracking</a></li>
                                <li><a class="dropdown-item" href="./appointment_tracking.html">Appointment Tracking</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" id="logout-btn">Log Out</a></li>
                            </ul>
                        </div>
                    </div>
                `;
                document.getElementById('logout-btn').addEventListener('click', function (e) {
                    e.preventDefault();
                    localStorage.clear();
                    updateHeader(); // Reset header to logged-out state
                    window.location.href = 'index.html';
                });
            } else {
                topHeader.innerHTML = `
                    <button class="btn btn-link me-2 text-white text-decoration-none" type="button" onclick="window.location.href='login.html'">Login</button>
                    <button class="btn btn-link text-white text-decoration-none" type="button" onclick="window.location.href='register.html'">Register</button>
                `;
            }
        }

        // Update header on page load
        updateHeader();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>